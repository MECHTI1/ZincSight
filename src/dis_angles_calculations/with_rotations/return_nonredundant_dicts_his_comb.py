#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Mon Jan 22 18:10:00 2024

@author: mechti
"""

import numpy as np
import time 

def euclidean_distance(coord1, coord2):
    return np.linalg.norm(coord1 - coord2)

def is_close(coord1, coord2, threshold=2):
    return euclidean_distance(coord1, coord2) < threshold

start=time.time()

processed_indices_to_move_out_dict_1 = set()

filtered_list_to_out = []

def main(list_all_comb_15degrotated_his,last_list_all_comb_15degrotated_his):
    for dict2 in last_list_all_comb_15degrotated_his:
        for i, dict1 in enumerate(list_all_comb_15degrotated_his):
            if i in processed_indices_to_move_out_dict_1:
                continue
            his_num=0
            similiar_his_numbers_with_orientation=0
            for key, value in dict1.items():
                if value[0] =='HIS':  # Checking specific residue types
                    his_num+=1
                    coord_current = dict1[key][1].get('ND1')  # Replace 'ND1' with the key you want to compare
                    coord_last= dict2[key][1].get('ND1') 
                    distance_between_points= euclidean_distance(coord_last, coord_current)
                    #print (distance_between_points)
                    if distance_between_points<0.1: 
                            similiar_his_numbers_with_orientation+=1
            if similiar_his_numbers_with_orientation==his_num:
                # print (dict1,dict2)
                #filtered_list_to_out.append(dict1)
                processed_indices_to_move_out_dict_1.add(i)
    
    # Remove the selected dictionaries from the original list
    for index in sorted(processed_indices_to_move_out_dict_1, reverse=True):
       del list_all_comb_15degrotated_his[index]
    return (list_all_comb_15degrotated_his)
                        
                    
if __name__=="__main__":             
    list_all_comb_15degrotated_his = [{'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.042, 21.875,  7.997]), 'ND1': np.array([90.137, 21.804,  8.229]), 'CE1': np.array([36.76 , 20.545,  8.2  ]), 'NE2': np.array([35.451, 20.57 ,  8.06 ])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.236, 20.46 , 11.168]), 'ND1': np.array([47.582, 18.72 , 11.012]), 'CE1': np.array([40.552, 19.28 ,  9.808]), 'NE2': np.array([39.755, 20.299,  9.919])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.042, 21.875,  7.997]), 'ND1': np.array([37.137, 21.804,  8.229]), 'CE1': np.array([36.76 , 20.545,  8.2  ]), 'NE2': np.array([35.451, 20.57 ,  8.06 ])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.09379576, 20.33361493, 11.11811652]), 'ND1': np.array([40.71662134, 18.84141569, 11.05954567]), 'CE1': np.array([40.63332145, 19.35300973,  9.83666028]), 'NE2': np.array([39.67367855, 20.22599027,  9.89033972])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.042, 21.875,  7.997]), 'ND1': np.array([37.137, 21.804,  8.229]), 'CE1': np.array([36.76 , 20.545,  8.2  ]), 'NE2': np.array([35.451, 20.57 ,  8.06 ])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.39879676, 20.55899649, 11.21679041]), 'ND1': np.array([40.42757707, 18.62454955, 10.96543782]), 'CE1': np.array([40.45877494, 19.22266822,  9.77994351]), 'NE2': np.array([39.84822506, 20.35633178,  9.94705649])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.03806221, 21.87745445,  8.18314436]), 'ND1': np.array([37.1413558 , 21.80161254,  8.04788871]), 'CE1': np.array([36.76218256, 20.5434873 ,  8.08529921]), 'NE2': np.array([35.44881744, 20.5715127 ,  8.17470079])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.236, 20.46 , 11.168]), 'ND1': np.array([40.582, 18.72 , 11.012]), 'CE1': np.array([40.552, 19.28 ,  9.808]), 'NE2': np.array([39.755, 20.299,  9.919])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.03806221, 21.87745445,  8.18314436]), 'ND1': np.array([37.1413558 , 21.80161254,  8.04788871]), 'CE1': np.array([36.76218256, 20.5434873 ,  8.08529921]), 'NE2': np.array([35.44881744, 20.5715127 ,  8.17470079])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.09379576, 20.33361493, 11.11811652]), 'ND1': np.array([40.71662134, 18.84141569, 11.05954567]), 'CE1': np.array([40.63332145, 19.35300973,  9.83666028]), 'NE2': np.array([39.67367855, 20.22599027,  9.89033972])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.03806221, 21.87745445,  8.18314436]), 'ND1': np.array([37.1413558 , 21.80161254,  8.04788871]), 'CE1': np.array([36.76218256, 20.5434873 ,  8.08529921]), 'NE2': np.array([35.44881744, 20.5715127 ,  8.17470079])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.39879676, 20.55899649, 11.21679041]), 'ND1': np.array([40.42757707, 18.62454955, 10.96543782]), 'CE1': np.array([40.45877494, 19.22266822,  9.77994351]), 'NE2': np.array([39.84822506, 20.35633178,  9.94705649])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.07820438, 21.87263   ,  7.81436682]), 'ND1': np.array([37.10125802, 21.80630411,  8.40660398]), 'CE1': np.array([36.7379313 , 20.54646122,  8.31257957]), 'NE2': np.array([35.4730687 , 20.56853878,  7.94742043])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.236, 20.46 , 11.168]), 'ND1': np.array([40.582, 18.72 , 11.012]), 'CE1': np.array([40.552, 19.28 ,  9.808]), 'NE2': np.array([39.755, 20.299,  9.919])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.07820438, 21.87263   ,  7.81436682]), 'ND1': np.array([37.10125802, 21.80630411,  8.40660398]), 'CE1': np.array([36.7379313 , 20.54646122,  8.31257957]), 'NE2': np.array([35.4730687 , 20.56853878,  7.94742043])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.09379576, 20.33361493, 11.11811652]), 'ND1': np.array([40.71662134, 18.84141569, 11.05954567]), 'CE1': np.array([40.63332145, 19.35300973,  9.83666028]), 'NE2': np.array([39.67367855, 20.22599027,  9.89033972])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.07820438, 21.87263   ,  7.81436682]), 'ND1': np.array([37.10125802, 21.80630411,  8.40660398]), 'CE1': np.array([36.7379313 , 20.54646122,  8.31257957]), 'NE2': np.array([35.4730687 , 20.56853878,  7.94742043])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.39879676, 20.55899649, 11.21679041]), 'ND1': np.array([42.42757707, 18.62454955, 10.96543782]), 'CE1': np.array([40.45877494, 19.22266822,  9.77994351]), 'NE2': np.array([39.84822506, 20.35633178,  9.94705649])}]}]
    last_list_all_comb_15degrotated_his = [{'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.042, 21.875,  7.997]), 'ND1': np.array([90.137, 21.804,  8.229]), 'CE1': np.array([36.76 , 20.545,  8.2  ]), 'NE2': np.array([35.451, 20.57 ,  8.06 ])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.236, 20.46 , 11.168]), 'ND1': np.array([40.582, 18.72 , 11.012]), 'CE1': np.array([40.552, 19.28 ,  9.808]), 'NE2': np.array([39.755, 20.299,  9.919])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.042, 21.875,  7.997]), 'ND1': np.array([37.137, 21.804,  8.229]), 'CE1': np.array([36.76 , 20.545,  8.2  ]), 'NE2': np.array([35.451, 20.57 ,  8.06 ])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.09379576, 20.33361493, 11.11811652]), 'ND1': np.array([40.71662134, 18.84141569, 11.05954567]), 'CE1': np.array([40.63332145, 19.35300973,  9.83666028]), 'NE2': np.array([39.67367855, 20.22599027,  9.89033972])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.042, 21.875,  7.997]), 'ND1': np.array([37.137, 21.804,  8.229]), 'CE1': np.array([36.76 , 20.545,  8.2  ]), 'NE2': np.array([35.451, 20.57 ,  8.06 ])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.39879676, 20.55899649, 11.21679041]), 'ND1': np.array([40.42757707, 18.62454955, 10.96543782]), 'CE1': np.array([40.45877494, 19.22266822,  9.77994351]), 'NE2': np.array([39.84822506, 20.35633178,  9.94705649])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.03806221, 21.87745445,  8.18314436]), 'ND1': np.array([37.1413558 , 21.80161254,  8.04788871]), 'CE1': np.array([36.76218256, 20.5434873 ,  8.08529921]), 'NE2': np.array([35.44881744, 20.5715127 ,  8.17470079])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.236, 20.46 , 11.168]), 'ND1': np.array([40.582, 18.72 , 11.012]), 'CE1': np.array([40.552, 19.28 ,  9.808]), 'NE2': np.array([39.755, 20.299,  9.919])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.03806221, 21.87745445,  8.18314436]), 'ND1': np.array([37.1413558 , 21.80161254,  8.04788871]), 'CE1': np.array([36.76218256, 20.5434873 ,  8.08529921]), 'NE2': np.array([35.44881744, 20.5715127 ,  8.17470079])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.09379576, 20.33361493, 11.11811652]), 'ND1': np.array([40.71662134, 18.84141569, 11.05954567]), 'CE1': np.array([40.63332145, 19.35300973,  9.83666028]), 'NE2': np.array([39.67367855, 20.22599027,  9.89033972])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.03806221, 21.87745445,  8.18314436]), 'ND1': np.array([37.1413558 , 21.80161254,  8.04788871]), 'CE1': np.array([36.76218256, 20.5434873 ,  8.08529921]), 'NE2': np.array([35.44881744, 20.5715127 ,  8.17470079])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.39879676, 20.55899649, 11.21679041]), 'ND1': np.array([40.42757707, 18.62454955, 10.96543782]), 'CE1': np.array([40.45877494, 19.22266822,  9.77994351]), 'NE2': np.array([39.84822506, 20.35633178,  9.94705649])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.07820438, 21.87263   ,  7.81436682]), 'ND1': np.array([37.10125802, 21.80630411,  8.40660398]), 'CE1': np.array([36.7379313 , 20.54646122,  8.31257957]), 'NE2': np.array([35.4730687 , 20.56853878,  7.94742043])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.236, 20.46 , 11.168]), 'ND1': np.array([40.582, 18.72 , 11.012]), 'CE1': np.array([40.552, 19.28 ,  9.808]), 'NE2': np.array([39.755, 20.299,  9.919])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.07820438, 21.87263   ,  7.81436682]), 'ND1': np.array([37.10125802, 21.80630411,  8.40660398]), 'CE1': np.array([36.7379313 , 20.54646122,  8.31257957]), 'NE2': np.array([35.4730687 , 20.56853878,  7.94742043])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.09379576, 20.33361493, 11.11811652]), 'ND1': np.array([40.71662134, 18.84141569, 11.05954567]), 'CE1': np.array([40.63332145, 19.35300973,  9.83666028]), 'NE2': np.array([39.67367855, 20.22599027,  9.89033972])}]}, {'A_69': ['HIS', {'CG': np.array([36.103, 22.677,  8.102]), 'CD2': np.array([35.07820438, 21.87263   ,  7.81436682]), 'ND1': np.array([37.10125802, 21.80630411,  8.40660398]), 'CE1': np.array([36.7379313 , 20.54646122,  8.31257957]), 'NE2': np.array([35.4730687 , 20.56853878,  7.94742043])}], 'A_122': ['ASP', {'OD1': np.array([41.26 , 24.248,  9.765]), 'OD2': np.array([39.156, 23.415,  9.817])}], 'A_118': ['HIS', {'CG': np.array([39.775, 19.425, 11.866]), 'CD2': np.array([39.39879676, 20.55899649, 11.21679041]), 'ND1': np.array([40.42757707, 18.62454955, 10.96543782]), 'CE1': np.array([40.45877494, 19.22266822,  9.77994351]), 'NE2': np.array([39.84822506, 20.35633178,  9.94705649])}]}]
    filtered_list_in=main(list_all_comb_15degrotated_his,last_list_all_comb_15degrotated_his)
    # 'filtered_list' now contains the filtered dictionaries from list_all_comb_15degrotated_his
    
    print (len(filtered_list_in))
    print (filtered_list_in)
    print (time.time()-start)
    
    
